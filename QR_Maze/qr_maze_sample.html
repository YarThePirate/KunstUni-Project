<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="author" content="Matt Scola">
	<meta name="format-detection" content="telephone=no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" />
	
	<title>Labyrinth</title>
	<style>
		
		body {
			background-color: black;
		}

		.start_screen {
			position: absolute;
			height: 100%; width: 100%;
			background-color: black;
			color: red;
			text-align: center;
			font-family: sans-serif;
		}

		.start_screen div {
			position: absolute;
			padding: 75px 0 75px 0;
			width: 30%;
			top: 30%; right: 10%;
			border: 4px solid red;
			font-size: 3em;
		}

		.qrcode {
			background-image: url("qrcode_final.png");
			height: 2000px; width: 2000px;
			z-index: -2;
		}

		.wrapper {
			padding: 750px;
			display: none;
		}

		#overlay {
			border-spacing: 0;
			height: 100%; width: 100%;
			margin: 0;
			padding: 0;
			z-index: 1;
		}

		#arrowTable {
			position: fixed;
			height: 600px; width: 600px;
			top: 50%; left: 50%;
			margin: -300px 0 0 -300px;
			table-layout: fixed;
			z-index: 0;
			display: none;
		}

		#arrowTable td {
			position: relative;
			height: 200px; width: 200px;
			padding: 0;
			margin: 0;
			/*
			border: dotted 2px red;
			*/
		}

		#arrowTable td img {
			position: absolute;
			top: 50%; left: 50%;
			margin: -30px 0 0 -30px;
			z-index: 0;
			/*
			border: dotted 1px green;
			*/
		}

		.tableCell {
			background-color: transparent;
			padding: 0;
			margin: 0;
			color: blue;
			text-align: center;
			height: 10%;
			width: 10%;
		}

		.tableCell img {
			display: none;
		}

		.dark {
			height: 100%;
			width: 100%;
			background-color: black;
			border: 0;
			color: white;
			z-index: 2;
		}

		.home {
			height: 50px; width: 100px;
			bottom: 0; right: 0;
			position: fixed;
			margin: 5px;
			border-radius: 2px;
			background-color: orange;
			text-align: center;
			padding-top: 20px;
		}

		.home a {
			text-decoration: none;
			color: black;
			font-family: sans-serif;
			font-size: 24px;
		}

		#up_arrow {
			-ms-transform: rotate(180deg); /* IE 9 */
			-webkit-transform: rotate(180deg); /* Chrome, Safari, Opera */
			-moz-transform: rotate(180deg);
			-o-transform: rotate(180deg);
			transform: rotate(180deg);
		}

		#right_arrow {
			-ms-transform: rotate(-90deg); /* IE 9 */
			-webkit-transform: rotate(-90deg); /* Chrome, Safari, Opera */
			-moz-transform: rotate(-90deg);
			-o-transform: rotate(-90deg);
			transform: rotate(-90deg);
		}

		#left_arrow {
			-ms-transform: rotate(90deg); /* IE 9 */
			-webkit-transform: rotate(90deg); /* Chrome, Safari, Opera */
			-moz-transform: rotate(90deg);
			-o-transform: rotate(90deg);
			transform: rotate(90deg);
		}
		
	</style>

	<!--
		Javascript Libraries - hosted on web
		(JQuery, JQuery UI, JQuery Mobile)
	
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
	<script src="http://http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
-->
	<!--
		Javascript Libraries - hosted locally
		(JQuery, JQuery UI, JQuery Mobile)
	-->
	<script src="../Scripts/jquery.js"></script>
	<script src="../Scripts/jquery-ui-1.10.4.min.js"></script>
	<!--script src="../Scripts/jquery-mobile-1.4.2.min.js"></script <== BAD COPY: GET NEW LOCAL COPY OF MOBILE LIBRARY -->
	<script src="../Scripts/jquery-ui-touch-punch-0.2.3.min.js"></script>
	<script src="../Scripts/jquery-scrollTo.min.js"></script>

</head>

<!-- START BODY -->
<body>

	<div class="start_screen">
		<div>
			Spielr√§ume
			<p style="font-size:18px">Lydia Hartl</p>
		</div>
	</div>

	<table id="arrowTable">
		<tr>
			<td></td>
			<td><img id="up_arrow" src="arrowDown_2.png"></td>
			<td></td>
		</tr>
		<tr>
			<td><img id="left_arrow" src="arrowDown_2.png"></td>
			<td></td>
			<td><img id="right_arrow" src="arrowDown_2.png"></td>
		</tr>
		<tr>
			<td></td>
			<td><img id="down_arrow" src="arrowDown_2.png"></td>
			<td></td>
		</tr>
	</table>
	
	<div class="wrapper">
		<div class="qrcode">
		
			<table id="overlay">
				<!-- 10 x 10 Table filled in by the script below -->
			</table>
		</div>
	</div>

	<div class="home"><a href="../index.html">Home</a></div>

	<script>
		var cells_with_links = {}; // a hash that holds the x and y coordinates of the cells containing links
		var current_cell; // a 1x2 array representing the row and column of the currently centered cell

		$(document).ready(function() {

			$(".start_screen").click(function() {
				$(this).fadeOut();
				$(".wrapper").show();
				placeLinks();
			});
						
			generateTable($("#overlay"));

			$(".tableCell").click(function() {
				var $cell = $(this)
				if (cellIsValid($cell)) {
					clickCell($cell);
				} else {
					showArrowTable();
				}
			});

		});


		/*
		------------------------FUNCTIONS---------------------------
		*/

		/*
			Centers the clicked cell on the screen
		*/
		function scrollToCell(cell) {
			var viewportWidth = $(window).width(),
					viewportHeight = $(window).height(),
					$cell = $(cell),
					elWidth = $cell.width(),
					elHeight = $cell.height(),
					elOffset = $cell.offset(),
					topPosition = (elOffset.top + (elHeight/2) - (viewportHeight/2)),
					leftPosition = (elOffset.left + (elWidth/2) - (viewportWidth/2));

			$.scrollTo({top:topPosition, left:leftPosition}, 800);

			var row = getRow($cell),
				col = getCol($cell);
			current_cell = [row, col];
		}

		/*
				Creates a 10 x 10 Table; all cells have a unique ID
				based on their row and column
		*/
		function generateTable( table ) {
			for (var x = 0; x < 10; x++) {
				table.append("<tr id=\"row" + x + "\"></tr>");
				for (var i = 0; i < 10; i++) {
					$("#overlay #row" + x).append("<td class=\"tableCell\" id=\"cell_" + x + "_" + i + "\"><div class=\"dark\"></div></td>")
				};
			};
		}

		/*
				Places links at X random spots on the
				#overlay table
		*/
		function placeLinks() {
			for (var i = 0; i < 9; i++) {
				var randomRow = Math.floor(Math.random() * 10);
				var randomCol = Math.floor(Math.random() * 10)
				
				if (i == 8) {
					setTimeout(function() {
						var $randomCell = $("#cell_" + randomRow + "_" + randomCol);
						$randomCell.addClass("clicked");
						scrollToCell($randomCell);
						$randomCell.children().fadeOut();
					}, 200);
				} else {
					var coordinates = randomRow + "_" + randomCol;
					cells_with_links[coordinates] = "Link #" + i;
				};
			};
			var links = [];
			for (var key in cells_with_links) {
				links.push(key + ": " + cells_with_links[key] + "\n");
			}

			alert(links);
		};

		/*
			Makes sure that the cell is adjacent to the cell just clicked
		*/
		function cellIsValid( cell ) {
			if (cell.hasClass("clicked")) {
				return true;
			}

			//var row = getRow(cell),
			//	col = getCol(cell);

			var row_check = Math.abs(current_cell[0] - getRow(cell)),
				col_check = Math.abs(current_cell[1] - getCol(cell));

			if (row_check + col_check != 1) {
				return false;
			}
			return true;
		}

		/*
			Uses the cell ID to parse an integer value for the row of a cell
		*/
		function getRow( cell ) {
			var row = parseInt(cell.attr('id').substring(5,6));
			return row;
		}

		/*
			Uses the cell ID to parse an integer value for the column a cell
		*/
		function getCol( cell ) {
			var col = parseInt(cell.attr('id').substring(7,8));
			return col;
		}

		/*
			Briefly displays the table of directional arrows
		*/
		function showArrowTable() {
			$("#arrowTable").fadeIn('slow').delay(250).fadeOut('slow');
		}

		/*
			Handles clicks on valid table cells
		*/
		function clickCell( cell ) {
			$(cell).addClass("clicked");
			$(cell).children().fadeOut();

			var coordinate = cell.attr('id').substring(5,8);
			if (cells_with_links.hasOwnProperty(coordinate)) {
				//alert(cells_with_links[coordinate]);
				showLink( $(cell) )
			};
			scrollToCell($(cell));

		}

		function showLink( cell ) {
			var random_button = Math.floor((Math.random() * 5) + 1);
			$(cell).html("<img src=\"Buttons/Buttons/Buttons-0" + random_button + ".jpg\">");
			$(cell).children().fadeIn();
		}
	</script>

</body>
</html>